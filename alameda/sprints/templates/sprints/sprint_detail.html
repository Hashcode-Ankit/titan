{% extends 'base.html' %}

{% block object_list_url %}{% url 'sprints:sprint-list' %}{% endblock %}

{% block content %}
	<nav class="level">
		<!-- Left side -->
		<div class="level-left">
			<nav class="breadcrumb is-large" aria-label="breadcrumbs">
				<ul>
          <li><a href="{% url 'sprints:sprint-list' %}">Sprints</a></li>
          <li class="is-active">
            <a href="#" aria-current="page">
              {{ object.title }}
            </a>
          </li>
				</ul>
			</nav>
		</div>

		<!-- Right side -->
		<div class="level-right">
			<div class="level-item">
				<a href="{% url 'sprints:sprint-edit' sprint.id %}" class="button is-success">
					<span class="icon is-small">
						<i class="fas fa-edit"></i>
					</span>
					<small>Edit</small>
				</a>
			</div>

      <div class="level-item">
				<div class="field has-addons">
					<p class="control">
            <a class="button is-success is-outlined" href="{% block object_add_url2 %}{% endblock %}">
              <span class="icon is-small">
                <i class="fas fa-copy"></i>
              </span>
              <small>Duplicate</small>
						</a>
					</p>
				</div>
			</div>

			<div class="level-item">
				<div class="field has-addons">
					<p class="control">
            <a class="button is-danger is-outlined" href="{% block object_add_url1 %}{% endblock %}">
              <span class="icon is-small">
                <i class="fas fa-minus"></i>
              </span>
              <small>Remove</small>
						</a>
					</p>
				</div>
			</div>

		</div>
	</nav>

	<div class="card">
		<div class="card-content">
			<div class="media">
				<div class="media-content">
					<p class="title is-4">{{ sprint.title }}</p>
          <p class="subtitle is-6">{{ sprint.starts_at }} to {{ sprint.ends_at }}</p>
				</div>
			</div>

			<div class="content">
				{{ sprint.description|default:'' }}<br/><br/>
				<div class="field is-grouped is-grouped-multiline">
					<div class="control">
						<div class="tags has-addons">
							<span class="tag">State</span>
							<span class="tag is-success">{{ sprint.get_state_display }}</span>
						</div>
					</div>
				</div>
				<strong>Progress:</strong>
				<br/>
				<br/>
				<progress class="progress is-success" value="{{ sprint.progress|default:'0' }}" max="100">{{ sprint.progress|default:'0' }}%</progress>
				<strong>Last Update:</strong> <time datetime="{{ sprint.updated_at }}">{{ sprint.updated_at }}</time>
			</div>
		</div>
	</div>

  <br/>
	<nav class="level">
		<!-- Left side -->
		<div class="level-left">
			<nav class="breadcrumb is-large" aria-label="breadcrumbs" style="margin: 0;">
				<ul>
					<li class="is-active"><a href="#" aria-current="page">Stories</a></li>
				</ul>
			</nav>

			<div class="level-item">
				<label>Group by</label>&nbsp;
				<div class="field">
					<div class="control">
						<div class="select is-link">
							<select>
								<option>Owner</option>
								<option>Assignee</option>
								<option>State</option>
								<option>Epic</option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Right side -->
		<div class="level-right">
			<div class="level-item">
				<div class="field has-addons">
					<p class="control">
            <a class="button is-success" href="{% url 'stories:story-add' %}?sprint={{ sprint.id }}">
              <span class="icon is-small">
                <i class="fas fa-plus"></i>
              </span>
              <small>Create</small>
						</a>
					</p>
				</div>
			</div>

      <div class="level-item">
				<div class="field has-addons">
					<p class="control">
            <a class="button is-success is-outlined" href="{% block object_add_url3 %}{% endblock %}">
              <span class="icon is-small">
                <i class="fas fa-search"></i>
              </span>
              <small>Add Existing</small>
						</a>
					</p>
				</div>
			</div>

			<div class="level-item">
				<div class="field has-addons">
					<p class="control">
            <a class="button is-danger is-outlined" href="{% block object_add_url4 %}{% endblock %}">
              <span class="icon is-small">
                <i class="fas fa-minus"></i>
              </span>
              <small>Remove from Sprint</small>
						</a>
					</p>
				</div>
			</div>

		</div>
	</nav>

	<table class="table is-bordered is-striped is-hoverable is-fullwidth">
		<thead>
      <tr>
        <th></th>
        <th><abbr title="Identification Number">ID</abbr></th>
        <th>Title</th>
        <th>Epic</th>
        <th>State</th>
        <th>Priority</th>
        <th><abbr title="Points">Pts</abbr></th>
        <th>Owner</th>
        <th>Assignee</th>
        <th>Actions</th>
      </tr>
		</thead>
		<tbody>
      {% for story in object_list %}
      <tr {% if story.is_done %}class="has-text-grey-dark"{% endif %}>
        <td>
          <input type="checkbox" name="story-{{ story.id }}" />
        </td>
        <td>#{{ story.id }}</td>
        <td>
          <a href="{% url 'stories:story-edit' story.id %}?sprint={{ sprint.id }}" {% if story.is_done %}class="has-text-grey-dark"{% endif %}>
            <strong>{{ story.title }}</strong><br/>
          </a>
          {% for tag in story.tags.all %}
          <span class="tag is-light">{{ tag.name }}</span>
          {% endfor %}
        </td>
        <td>
          {% if story.epic %}
          <a href="{% url 'stories:epic-detail' story.epic.id %}" {% if story.is_done %}class="has-text-grey-dark"{% endif %}>
            {{ story.epic.title }}
          </a>
          {% endif %}
        </td>
        <td>{{ story.state }}</td>
        <td>{{ story.priority }}</td>
        <td>{{ story.points }}</td>
        <td>{{ story.owner.username }}</td>
        <td>{{ story.assignee.username }}</td>
        <td>
          <a class="button is-link is-small is-outlined" href="{% url 'stories:story-edit' story.id %}?sprint={{ sprint.id }}" title="Edit">
						<span class="icon is-small">
							<i class="fas fa-edit"></i>
						</span>
						<small>edit</small>
          </a>
        </td>
      </tr>
      {% endfor %}
		</tbody>
	</table>

  <nav class="pagination" role="navigation" aria-label="pagination">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="pagination-previous" title="This is the first page">&laquo;</a>
    {% else %}
      <a class="pagination-previous" title="This is the first page" disabled>&laquo;</a>
    {% endif %}
    {% if show_all_url %}
      <a class="pagination-link" href="{{ show_all_url }}">Show All</a>
    {% endif %}
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="pagination-next">&raquo;</a>
    {% else %}
      <a class="pagination-next" disabled>&raquo;</a>
    {% endif %}
    <ul class="pagination-list">
    {% for i in paginator.page_range %}
      {% if page_obj.number == i %}
        <li><a href="?page={{ i }}" class="pagination-link is-current" aria-label="Page {{ i }}" aria-current="page">{{ i }}</a></li>
      {% else %}
        <li><a href="?page={{ i }}" class="pagination-link" aria-label="Goto page {{ i }}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}
    </ul>
  </nav>

{% endblock %}
